<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <title>Kontoansicht</title>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
      integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N"
      crossorigin="anonymous"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />

    <link type="text/css" href="../CSS/Homepage.css" rel="stylesheet" />
    <link type="text/css" href="../CSS/Kontoansicht.css" rel="stylesheet" />
    <link type="text/css" href="../CSS/Footer.css" rel="stylesheet" />

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.min.js"></script>
  </head>
  <body onload="checkToken()" style="display: none">
    <header>
      <div class="logo-container">
        <img src="/homepage/logo.png" alt="Logo" />
        <h1 class="logo-title">
          <span class="logo-name">Aktiv</span>
          <span class="normal-letters">itizer </span>
        </h1>
      </div>

      <nav class="navbar">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a href="/home" class="nav-link">Home</a>
          </li>
          <li class="nav-item">
            <a href="/kontaktformular" class="nav-link">Contact</a>
          </li>
          <li class="nav-item">
            <a href="/about" class="nav-link">About</a>
          </li>

          <div class="dropdown">
            <a
              href="#"
              class="dropdown-toggle"
              id="dropdownMenuButton"
              data-toggle="dropdown"
            >
              <img src="/homepage/user.png" alt="DropdownMenu" width="30px" />
            </a>

            <div class="dropdown-menu dropdown-menu-fixed">
              <a
                class="dropdown-item dropdown_menue meine_buchungen"
                href="/kontoansicht"
                >Meine Buchungen</a
              >
              <a
                class="dropdown-item dropdown_menue zahlungsdetails_"
                href="/kontoansicht"
                >Zahlungsdetails</a
              >
              <a
                class="dropdown-item dropdown_menue aktivitaet_erstellen"
                href="/kontoansicht"
                >Aktivität erstellen</a
              >
              <a
                class="dropdown-item dropdown_menue meine_erstellten_aktivitaeten"
                href="/kontoansicht"
                >Meine Erstellten Aktivitäten
              </a>
              <div class="dropdown-divider dropdown_menue"></div>
              <a class="dropdown-item dropdown_menue" href="/kontoansicht"
                >Mein Konto</a
              >
              <a class="dropdown-item" id="dropdown_login" href="/login"
                >Login/Registrierung</a
              >
              <a
                class="dropdown-item"
                id="dropdown_logout"
                href="/home"
                onclick="logoutUser()"
                >Logout</a
              >
            </div>
          </div>
        </ul>
      </nav>
    </header>
    <hr class="separator" />

    <div class="container-fluid p-0">
      <div class="custom-banner bg-secondary">
        <div class="row align-items-center">
          <div class="col-10">
            <h1 style="color: white"><span id="userprofil"></span></h1>
          </div>
        </div>
      </div>
      <!-- Tabs als Navbar -->
      <ul class="nav nav-tabs bg-light">
        <li class="nav-item">
          <a
            class="nav-link meine_buchungen"
            data-toggle="tab"
            href="#meine-buchungen"
            >Meine Buchungen</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link zahlungsdetails_"
            data-toggle="tab"
            href="#zahlungsdetails"
            >Zahlungsdetails</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link aktivitaet_erstellen"
            data-toggle="tab"
            href="#aktivitaet-erstellen"
            >Aktivitätserstellung</a
          >
        </li>

        <li class="nav-item">
          <a
            class="nav-link meine_erstellten_aktivitaeten"
            data-toggle="tab"
            href="#meine-aktivitaeten"
            >Meine Erstellten Aktivitäten
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link active" data-toggle="tab" href="#mein-konto"
            >Mein Konto</a
          >
        </li>
      </ul>

      <!-- Tab-Inhalte -->
      <div class="tab-content">
        <div id="meine-buchungen" class="tab-pane fade">
          <!-- Inhalt für den Tab "Meine Buchungen" -->
          <div class="container mt-3">
            <div class="row">
              <div class="col-12">
                <div class="card mb-3">
                  <div class="row no-gutters">
                    <div class="col-md-8">
                      <img
                        src="https://www.bootdey.com/image/800x300/6495ED/000000"
                        class="card-img w-100 h-100"
                        alt="..."
                      />
                    </div>
                    <div class="col-md-4">
                      <div class="card-body">
                        <h5 class="card-title">Post title 1</h5>
                        <p class="card-text">
                          Lorem ipsum dolor sit amet, consectetur adipiscing
                          elit. Nullam tristique libero et est iaculis, id
                          placerat nisi luctus. Aenean volutpat risus non
                          fermentum feugiat...
                        </p>
                        <div class="row">
                          <label for="datum" class="col-6">Datum:</label>
                          <input
                            class="form-control col-5"
                            type="text"
                            placeholder=" DD/MM/YY"
                            style="text-align: right"
                            readonly
                          />
                        </div>
                        <br />
                        <div class="row">
                          <label for="ort" class="col-4">Ort: </label>
                          <input
                            class="form-control col-7"
                            type="text"
                            placeholder="Stadt, Land"
                            style="text-align: right"
                            readonly
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="container mt-3">
            <div class="row">
              <div class="col-12">
                <div class="card mb-3">
                  <div class="row no-gutters">
                    <div class="col-md-8">
                      <img
                        src="https://www.bootdey.com/image/800x300/35682D/000000"
                        class="card-img w-100 h-100"
                        alt="..."
                      />
                    </div>
                    <div class="col-md-4">
                      <div class="card-body">
                        <h5 class="card-title">Post title 2</h5>
                        <p class="card-text">
                          Lorem ipsum dolor sit amet, consectetur adipiscing
                          elit. Nullam tristique libero et est iaculis, id
                          placerat nisi luctus. Aenean volutpat risus non
                          fermentum feugiat...
                        </p>
                        <div class="row">
                          <label for="datum" class="col-6">Datum:</label>
                          <input
                            class="form-control col-5"
                            type="text"
                            placeholder=" DD/MM/YY"
                            style="text-align: right"
                            readonly
                          />
                        </div>
                        <br />
                        <div class="row">
                          <label for="ort" class="col-4">Ort: </label>
                          <input
                            class="form-control col-7"
                            type="text"
                            placeholder="Stadt, Land"
                            style="text-align: right"
                            readonly
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="container mt-3">
            <div class="row">
              <div class="col-12">
                <div class="card mb-3">
                  <div class="row no-gutters">
                    <div class="col-md-8">
                      <img
                        src="https://www.bootdey.com/image/800x300/C8A2C8/000000"
                        class="card-img w-100 h-100"
                        alt="..."
                      />
                    </div>
                    <div class="col-md-4">
                      <div class="card-body">
                        <h5 class="card-title">Post title 3</h5>
                        <p class="card-text">
                          Lorem ipsum dolor sit amet, consectetur adipiscing
                          elit. Nullam tristique libero et est iaculis, id
                          placerat nisi luctus. Aenean volutpat risus non
                          fermentum feugiat...
                        </p>
                        <div class="row">
                          <label for="datum" class="col-6">Datum:</label>
                          <input
                            class="form-control col-5"
                            type="text"
                            placeholder=" DD/MM/YY"
                            style="text-align: right"
                            readonly
                          />
                        </div>
                        <br />
                        <div class="row">
                          <label for="ort" class="col-4">Ort: </label>
                          <input
                            class="form-control col-7"
                            type="text"
                            placeholder="Stadt, Land"
                            style="text-align: right"
                            readonly
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div style="margin-top: 5%"></div>
        </div>

        <div id="zahlungsdetails" class="tab-pane fade">
          <!-- Inhalt für den Tab "Zahlungsdetails" -->
          <p class="mt-3 p-2 lead">Zahlungsdetails</p>
          <p class="small text-left mt-3 p-2">
            Hier werden die Zahlungsdetails gespeichert und neue Karten
            hinzugefügt
          </p>
          <div class="payment-details">
            <form>
              <br />
              <span id="card-header" class="p-2">Gespeicherte Karten:</span>
              <div class="row row-1">
                <div style="margin-left: 35px">
                  <img
                    class="img-fluid"
                    src="https://img.icons8.com/color/48/000000/mastercard-logo.png"
                  />
                </div>
                <input
                  class="form-control col-2"
                  style="text-align: center"
                  type="text"
                  placeholder="**** **** **** 3193"
                  readonly
                />
                <div class="form-control custom-div col-2">
                  <a style="color: gray; font-weight: bold" href="#"
                    >Karte entfernen</a
                  >
                </div>
              </div>
              <div class="row row-1">
                <div style="margin-left: 35px">
                  <img
                    class="img-fluid"
                    src="https://img.icons8.com/color/48/000000/visa.png"
                  />
                </div>
                <input
                  class="form-control col-2"
                  style="text-align: center"
                  type="text"
                  placeholder="**** **** **** 4296"
                  readonly
                />
                <div class="form-control custom-div col-2">
                  <a style="color: gray; font-weight: bold" href="#"
                    >Karte entfernen</a
                  >
                </div>
              </div>
              <br />
              <span id="card-header" class="p-2">Neue Karte hinzufügen:</span>
              <div class="row-1">
                <div class="p-3 col-2">
                  <div class="row row-2">
                    <div class="col-4">
                      <label for="karteninhaber">Karteninhaber</label>
                      <input
                        class="form-control"
                        type="text"
                        placeholder=""
                        id="karteninhaber"
                        style="width: auto"
                      />
                    </div>
                  </div>
                </div>
              </div>
              <div class="row three">
                <div class="p-3">
                  <div class="form-group">
                    <div class="row row-2">
                      <div class="col-4">
                        <label for="kartennummer">Kartennummer</label>
                        <input
                          class="form-control"
                          type="number"
                          placeholder="5134 5264 **** ****"
                        />
                      </div>
                      <div class="col-3">
                        <label for="ablaufdatum">Ablaufdatum</label>
                        <input
                          class="form-control"
                          type="numer"
                          placeholder="MM/YY"
                        />
                      </div>
                      <div class="col-2">
                        <label for="cvv">CVV</label>
                        <input
                          class="form-control"
                          type="number"
                          placeholder="CVV"
                        />
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="text-right p-2" style="margin-top: 30px">
                <button class="btn btn-secondary">
                  <b>Karte hinzufügen</b>
                </button>
              </div>
            </form>
          </div>
        </div>
        <!-- Nur verfügbar für Unternehmenskonten-->
        <div id="aktivitaet-erstellen" class="tab-pane fade">
          <!-- Inhalt für den Tab "aktivität erstellen" -->
          <p class="mt-3 p-2 lead">Aktivität erstellen</p>
          <p class="small text-left mt-3 p-2">
            Hier können Sie eine Aktivität hochladen.
          </p>
          <form id="aktivitaetForm" enctype="multipart/form-data">
            <!-- Anbieter Name -->
            <div class="form-group row">
              <label class="col-sm-2 col-form-label" for="fname"
                >Anbieter</label
              >
              <div class="col-sm-5">
                <input
                  type="text"
                  class="form-control"
                  id="anbieter"
                  placeholder="Enter Anbieter Name"
                  name="fname"
                />
              </div>
            </div>

            <!-- Titel der Aktivität -->
            <div class="form-group row">
              <label class="col-sm-2 col-form-label" for="lname"
                >Titel der Aktivität</label
              >
              <div class="col-sm-5">
                <input
                  type="text"
                  class="form-control"
                  id="titel"
                  placeholder="Aktivität Name"
                  name="lname"
                />
              </div>
            </div>

            <!-- Address -->
            <div class="form-group row">
              <label class="col-sm-2 col-form-label">Adresse:</label>
              <div class="col-sm-2">
                <input
                  type="text"
                  class="form-control"
                  placeholder="PLZ"
                  name="plz"
                  id="plz"
                />
              </div>
              <div class="col-sm-3">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Ort"
                  name="ort"
                  id="ort"
                />
              </div>
              <div class="col-sm-2">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Straße"
                  name="strasse"
                  id="straße"
                />
              </div>
              <div class="col-sm-1">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Hausnr"
                  name="hausnr"
                  id="nr"
                />
              </div>
            </div>

            <!-- Dauer -->
            <div class="form-group row">
              <label class="col-sm-2 col-form-label" for="dauer">Dauer:</label>
              <div class="col-sm-2">
                <input
                  type="number"
                  class="form-control"
                  step="0.01"
                  id="dauer"
                  placeholder="0.00"
                  name="dauer"
                />
              </div>
              <div class="col-sm-2">
                <input type="time" class="form-control" id="start" name="time" />
              </div>
            </div>

            <!-- Datum -->
            <div class="form-group row">
              <label class="col-sm-2 col-form-label" for="date">Datum:</label>
              <div class="col-sm-5">
                <input
                  type="text"
                  class="form-control"
                  id="datum"
                  placeholder="dd.mm.yyyy - dd.mm.yyyy"
                  name="dateRange"
                />
              </div>
              <div class="col-sm-2">
                <select class="form-control" id="day" name="day">
                  <option value="Mo">Monday</option>
                  <option value="Tue">Tuesday</option>
                  <option value="Wed">Wednesday</option>
                  <option value="Thu">Thursday</option>
                  <option value="Fri">Friday</option>
                  <option value="Saturday">Saturday</option>
                  <option value="Sunday">Sunday</option>
                </select>
              </div>
            </div>

            <!-- Bilder anhängen -->
            <div class="form-group row">
              <label class="col-sm-2 col-form-label">Bilder Anhängen:</label>
              <div class="col-sm-5">
                <input
                  type="file"
                  class="form-control-file"
                  id="picture"
                  name="picture"
                />
              </div>
            </div>

            <!-- Anzahl Personen -->
            <div class="form-group row">
              <label class="col-sm-2 col-form-label" for="anzahl"
                >Anzahl Personen:</label
              >
              <div class="col-sm-2">
                <input
                  type="number"
                  class="form-control"
                  id="anzahlP"
                  placeholder="0"
                  name="anzahl"
                />
              </div>
            </div>

            <!-- Preis pro Person -->
            <div class="form-group row">
              <label class="col-sm-2 col-form-label" for="price"
                >Preis pro Person:</label
              >
              <div class="col-sm-3">
                <div class="input-group">
                  <input
                    type="number"
                    class="form-control"
                    id="preis"
                    placeholder="0.00"
                    name="price"
                    step="0.01"
                  />
                  <div class="input-group-append">
                    <span class="input-group-text">€</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Comments -->
            <div class="form-group row">
              <label class="col-sm-2 col-form-label" for="comment"
                >Comment:</label
              >
              <div class="col-sm-5">
                <textarea class="form-control" rows="5" id="beschreibung"></textarea>
              </div>
            </div>

            <div class="form-group row">
              <div class="col-sm-10 offset-sm-2">
                <button type="submit" class="btn btn-secondary">
                  <b>Hochladen</b>
                </button>
              </div>
            </div>
          </form>
        </div>

        <div id="meine-aktivitaeten" class="tab-pane fade">
          <!-- Inhalt für den Tab "Meine Buchungen" -->
          <div class="container mt-3">
            <div class="row">
              <div class="col-12">
                <div class="card mb-3">
                  <div class="row no-gutters">
                    <div class="col-md-8">
                      <img
                        src="https://www.bootdey.com/image/800x300/6495ED/000000"
                        class="card-img w-100 h-100"
                        alt="..."
                      />
                    </div>
                    <div class="col-md-4">
                      <div class="card-body">
                        <h5 class="card-title">Post title 1</h5>
                        <p class="card-text">
                          Lorem ipsum dolor sit amet, consectetur adipiscing
                          elit. Nullam tristique libero et est iaculis, id
                          placerat nisi luctus. Aenean volutpat risus non
                          fermentum feugiat...
                        </p>
                        <!-- Hier wird sich ein Dialog öffnen mit den man die Details angucken kann, es wird so aussehen wie Aktivitaetsansicht.html-->
                        <div class="row">
                          <button
                            type="button"
                            class="btn btn-secondary"
                            style="width: 100%"
                          >
                            <i class="far fa-file-alt"></i> Details
                          </button>
                        </div>

                        <br />
                        <div class="row">
                          <button
                            type="button"
                            class="btn btn-secondary"
                            style="width: 100%"
                          >
                            <i class="far fa-edit"></i> Ändern
                          </button>
                        </div>
                        <div class="row">
                          <button
                            type="button"
                            class="btn btn-outline-secondary"
                            style="width: 100%; padding: 5px; margin-top: 17px"
                          >
                            <i class="far fa-trash-alt"></i>Löschen
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div style="margin-top: 5%"></div>
        </div>

        <div id="mein-konto" class="tab-pane fade show active">
          <!-- Inhalt für den Tab "Mein Konto" -->
          <p class="mt-3 p-2 lead">Konto</p>
          <p class="small text-left mt-3 p-2">
            Hier können persönliche Angaben geändert werden<br /><br />E-Mail-Anmeldung:<br /><span
              id="useremail"
            ></span>
          </p>
          <p class="small text-muted p-2">
            Die E-Mail zur Anmeldung kann nicht geändert werden
          </p>
          <form>
            <div class="form-group p-2">
              <div class="row">
                <div class="col-3">
                  <label for="vorname">Vorname</label>
                  <input
                    type="text"
                    class="form-control"
                    id="vorname"
                    name="vorname"
                  />
                </div>
                <div class="col-3">
                  <label for="nachname">Nachname</label>
                  <input
                    type="text"
                    class="form-control"
                    id="nachname"
                    name="nachname"
                  />
                </div>
              </div>
            </div>
            <div class="form-group p-2">
              <div class="row">
                <div class="col-3">
                  <label for="telefonnummer">Telefonnummer</label>
                  <input
                    type="number"
                    class="form-control"
                    id="telefonnummer"
                    name="telefonnummer"
                  />
                </div>
              </div>
            </div>
            <div class="text-right p-2" style="margin-top: 30px">
              <button
                type="button"
                class="btn btn-outline-secondary"
                id="verwerfen"
              >
                Verwerfen
              </button>
              <button
                type="button"
                class="btn btn-secondary"
                id="info-aktualisieren"
              >
                Info aktualisieren
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!--Inhalt Footer-->
    <footer>
      <div class="container" ;>
        <div class="row">
          <div class="col-md-6">
            <span class="copyright">©2023 Aktivitizer</span>
          </div>
          <div class="col-md-6">
            <a class="privacy-policy" href="#">Privacy Policy</a>
          </div>
        </div>
      </div>
    </footer>
    <script>
      function profil_Kunde() {
        $(document).ready(function () {
          $.ajax({
            url: "http://localhost:8000/api/kunde/profil",
            type: "get",
            headers: {
              Authorization: "Bearer " + sessionStorage.getItem("accessToken"),
            },
          })
            .done(function (response) {
              console.log(response);
              document.getElementById("useremail").innerText = response.email;
              document.getElementById("karteninhaber").placeholder =
                response.name;
              document.getElementById("userprofil").innerText = response.name;
              //console.log(response.rolleId);
              if (response.rolleId === 2) {
                //Kunde = 2, Unternehmen = 3
                var aktivitaetErstellenTabs = document.getElementsByClassName(
                  "aktivitaet_erstellen"
                );
                var meineErstelltenAktivitaetenTabs =
                  document.getElementsByClassName(
                    "meine_erstellten_aktivitaeten"
                  );

                Array.from(aktivitaetErstellenTabs).forEach(function (tab) {
                  tab.style.display = "none";
                });

                Array.from(meineErstelltenAktivitaetenTabs).forEach(function (
                  tab
                ) {
                  tab.style.display = "none";
                });
              } else if (response.rolleId === 3) {
                var zahlungsdetailsTabs =
                  document.getElementsByClassName("zahlungsdetails_");
                var meineBuchungenTabs =
                  document.getElementsByClassName("meine_buchungen");

                Array.from(meineBuchungenTabs).forEach(function (tab) {
                  tab.style.display = "none";
                });

                Array.from(zahlungsdetailsTabs).forEach(function (tab) {
                  tab.style.display = "none";
                });
              }
            })
            .fail(function (jqXHR, statusText, error) {
              //console.error('Fehler beim Abrufen der Benutzerdaten:', statusText, error);
              return false;
            });
        });
      }
      function profil_Unternehmen() {
        $(document).ready(function () {
          $.ajax({
            url: "http://localhost:8000/api/unternehmen/profil",
            type: "get",
            headers: {
              Authorization: "Bearer " + sessionStorage.getItem("accessToken"),
            },
          })
            .done(function (response) {
              console.log(response);
              document.getElementById("useremail").innerText = response.email;
              document.getElementById("userprofil").innerText = response.name;
              //console.log(response.rolleId);
              if (response.rolleId === 2) {
                //Kunde = 2, Unternehmen = 3
                var aktivitaetErstellenTabs = document.getElementsByClassName(
                  "aktivitaet_erstellen"
                );
                var meineErstelltenAktivitaetenTabs =
                  document.getElementsByClassName(
                    "meine_erstellten_aktivitaeten"
                  );

                Array.from(aktivitaetErstellenTabs).forEach(function (tab) {
                  tab.style.display = "none";
                });

                Array.from(meineErstelltenAktivitaetenTabs).forEach(function (
                  tab
                ) {
                  tab.style.display = "none";
                });
              } else if (response.rolleId === 3) {
                var zahlungsdetailsTabs =
                  document.getElementsByClassName("zahlungsdetails_");
                var meineBuchungenTabs =
                  document.getElementsByClassName("meine_buchungen");

                Array.from(meineBuchungenTabs).forEach(function (tab) {
                  tab.style.display = "none";
                });

                Array.from(zahlungsdetailsTabs).forEach(function (tab) {
                  tab.style.display = "none";
                });
              }
            })
            .fail(function (jqXHR, statusText, error) {
              //console.error('Fehler beim Abrufen der Benutzerdaten:', statusText, error);
              return false;
            });
        });
      }
      function checkToken() {
        const accessToken = sessionStorage.getItem("accessToken");
        if (!accessToken) {
          var dropdown_m = document.getElementsByClassName("dropdown_menue");

          Array.from(dropdown_m).forEach(function (tab) {
            tab.style.display = "none";
          });
          document.getElementById("dropdown_logout").style.display = "none";
        } else {
          document.getElementById("dropdown_login").style.display = "none";
          profil_Kunde();
          profil_Unternehmen();

          const jwtPayload = JSON.parse(window.atob(accessToken.split(".")[1]));
          const datetime = new Date(jwtPayload.exp * 1000);
          console.log("expiry time (epoch):", jwtPayload.exp * 1000);
          console.log("expiry time (ISO):", datetime.toISOString());
          const isExpired = Date.now() >= jwtPayload.exp * 1000;
          console.log("token is expired:", isExpired);
          if (isExpired == true) {
            window.location = "/login";
          } else {
            document.getElementsByTagName("body")[0].style.display = "block";
          }
        }
      }
      function logoutUser() {
        sessionStorage.removeItem("accessToken");
      }
      /*
    $(document).ready(function() {
      // Dropdown-Menü-Elemente
      $('.dropdown-item').on('click', function(e) {
        e.preventDefault(); // Verhindert das Standardverhalten des Links
        var targetTab = $(this).attr('href'); // Holt den Ziel-Tabinhalt
        $('.nav-link').removeClass('active'); // Entfernt die aktive Klasse von allen Tabs
        $('.tab-pane').removeClass('show active'); // Versteckt alle Tab-Inhalte
        $(targetTab).addClass('show active'); // Zeigt den ausgewählten Tab-Inhalt an
      });
    });
    */
    $(document).ready(function() {
        $('#aktivitaetForm').submit(function(event) {
          event.preventDefault(); // Verhindert das Standardverhalten des Formulars (Seitenaktualisierung)
          console.log('Formular abgeschickt!');

          // convert data of form to object
          var formData = new FormData();
          var fileInput = $('#picture')[0].files[0];
          formData.append('picture', fileInput);
          // send form with ajax
          $.ajax({
              url: 'http://localhost:8000/api/dateiuploadeinzeln',
              type: 'post',
              data: formData,
              contentType: false,
              cache: false,
              processData: false,
              dataType: 'json'
          })
          .done(function(response) {
              console.log('response received');
              console.log(response);
              var url = response.fileName;
              $.ajax({
                url: 'http://localhost:8000/api/unternehmen/profil',
                type: "get",
                headers: {
                  Authorization: "Bearer " + sessionStorage.getItem("accessToken"),
                },
              })
              .done(function(response) {
                var unternehmenId = response.id;
                console.log(unternehmenId)
                var userData = {
                organization: $('#anbieter').val(),
                name: $('#titel').val(),
                plz: $('#plz').val(),
                city: $('#ort').val(),
                address: $('#straße').val(),
                nr: $('#nr').val(),
                duration: $('#dauer').val(),
                start: $('#start').val(),
                date: $('#datum').val(),
                picture_url: url,
                person_amount: $('#anzahlP').val(),
                price: $('#preis').val(),
                comment: $('#beschreibung').val(),
                unternehmenId: unternehmenId
                };        
                $.ajax({
                  url: 'http://localhost:8000/api/aktivitaeten/',
                  method: 'post',
                  contentType: 'application/json; charset=utf-8',
                  data: JSON.stringify(userData),
                  cache: false,
                  dataType: 'json'
                }).done(function (response) {
                  console.log(response);
                  alert('Aktivität erfolgreich hochgeladen!');
                }).fail(function (jqXHR, statusText, error) {
                  console.log('Response Code: ' + jqXHR.status + ' - Fehlermeldung: ' + jqXHR.responseText);
                  const responseObj = JSON.parse(jqXHR.responseText);
                  if (responseObj.errors && responseObj.errors.length > 0) {
                    responseObj.errors.forEach(error => {
                      alert(error.msg);
                    });
                  } else {
                    alert('Ein unbekannter Fehler ist aufgetreten.');
                  }    
                });
              })
              .fail(function(xhr) {
                console.log('error received');
              })
          })
          .fail(function(xhr) {
              console.log('error received');
          });
        });
      });
    </script>
  </body>
</html>