<!DOCTYPE html>
<html>
  <head>
    <title>Kontaktformular</title>

    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/css/bootstrap.min.css"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link type="text/css" href="../CSS/Homepage.css" rel="stylesheet" />
    <link type="text/css" href="../CSS/Kontaktformular.css" rel="stylesheet" />
    <link type="text/css" href="../CSS/Footer.css" rel="stylesheet" />

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.min.js"></script>
  </head>

  <body onload="checkToken()">
    <header>
      <div class="logo-container">
        <img src="/homepage/logo.png" alt="Logo" />
        <h1 class="logo-title">
          <span class="logo-name">Aktiv</span>
          <span class="normal-letters">itizer </span>
        </h1>
      </div>

      <nav class="navbar">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a href="/home" class="nav-link">Home</a>
          </li>
          <li class="nav-item">
            <a href="/kontaktformular" class="nav-link">Contact</a>
          </li>
          <li class="nav-item">
            <a href="/about" class="nav-link">About</a>
          </li>

          <div class="dropdown">
            <a
              href="#"
              class="dropdown-toggle"
              id="dropdownMenuButton"
              data-toggle="dropdown"
            >
              <img src="/homepage/user.png" alt="DropdownMenu" width="30px" />
            </a>

            <div class="dropdown-menu dropdown-menu-fixed">
              <a
                class="dropdown-item dropdown_menue meine_buchungen"
                href="/kontoansicht"
                >Meine Buchungen</a
              >
              <a
                class="dropdown-item dropdown_menue zahlungsdetails_"
                href="/kontoansicht"
                >Zahlungsdetails</a
              >
              <a
                class="dropdown-item dropdown_menue aktivitaet_erstellen"
                href="/kontoansicht"
                >Aktivität erstellen</a
              >
              <a
                class="dropdown-item dropdown_menue meine_erstellten_aktivitaeten"
                href="/kontoansicht"
                >Meine Erstellten Aktivitäten
              </a>
              <div class="dropdown-divider dropdown_menue"></div>
              <a class="dropdown-item dropdown_menue" href="/kontoansicht"
                >Mein Konto</a
              >
              <a class="dropdown-item" id="dropdown_login" href="/login"
                >Login/Registrierung</a
              >
              <a
                class="dropdown-item"
                id="dropdown_logout"
                href="/home"
                onclick="logoutUser()"
                >Logout</a
              >
            </div>
          </div>
        </ul>
      </nav>
    </header>
    <hr class="separator" />
    <main>
      <div class="container">
        <div class="container-fluid p-0">
          <div class="p-5">
            <div class="tab-pane fade show active">
              <p class="mt-3 p-2" style="font-size: 35px">Kontakt aufnehmen</p>
              <form id="kontaktForm">
                <div class="form-group p-2">
                  <div class="row">
                    <div class="col-3">
                      <p class="text-left mt-3 p-2">
                        Telefonnummer<br />+49 123 456789
                      </p>
                    </div>
                    <div class="col-3">
                      <p class="text-left mt-3 p-2">
                        E-Mail-Adresse<br />info@website.com
                      </p>
                    </div>
                    <div class="col-3">
                      <p class="text-left mt-3 p-2">
                        Social Media<br />
                        <a href="#" class="fa fa-facebook"></a>
                        <a href="#" class="fa fa-twitter"></a>
                        <a href="#" class="fa fa-linkedin"></a>
                        <a href="#" class="fa fa-instagram"></a>
                      </p>
                    </div>
                  </div>
                  <br />
                  <div class="row">
                    <div class="col-3">
                      <label for="vorname">Vorname</label>
                      <input
                        type="text"
                        id="vorname"
                        class="form-control"
                        style="border-color: #333"
                      />
                    </div>
                    <div class="col-3">
                      <label for="nachname">Nachname</label>
                      <input
                        type="text"
                        id="nachname"
                        class="form-control"
                        style="border-color: #333"
                      />
                    </div>
                    <div class="col-3">
                      <label for="email">E-Mail</label>
                      <input
                        type="text"
                        id="email"
                        class="form-control"
                        style="border-color: #333"
                      />
                    </div>
                  </div>
                </div>
                <div class="form-group p-2">
                  <div class="row">
                    <div class="col-9">
                      <label for="telefonnummer">Nachricht</label>
                      <textarea
                        id="nachricht"
                        name="message"
                        class="form-control"
                        rows="4"
                        style="border-color: #333"
                      ></textarea>
                    </div>
                  </div>
                </div>
                <div class="align-items-center p-2" style="margin-top: 30px">
                  <button
                    type="submit"
                    class="btn btn-secondary col-3"
                    id="senden"
                  >
                    Senden
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer>
      <div class="container" ;>
        <div class="row">
          <div class="col-md-6">
            <span class="copyright">©2023 Aktivitizer</span>
          </div>
          <div class="col-md-6">
            <a class="privacy-policy" href="#">Privacy Policy</a>
          </div>
        </div>
      </div>
    </footer>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      $(document).ready(function () {
        $("#kontaktForm").submit(function (event) {
          var formData = {
            name: $("#vorname").val(), // Ersetzen Sie '#nameFeld' mit der ID Ihres Namensfeldes im Formular
            nachname: $("#nachname").val(), // Ersetzen
            email: $("#email").val(), // Ersetzen Sie '#emailFeld' mit der ID Ihres E-Mail-Feldes
            nachricht: $("#nachricht").val(), // Ersetzen Sie '#nachrichtFeld' mit der ID Ihres Nachrichtenfeldes
          };

          $.ajax({
            url: "http://localhost:8000/api/kontaktformular", // URL, die auf Ihre `kontaktformular.js`-Route im `services`-Ordner zeigt
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(formData),
            success: function (response) {
              console.log("Erfolg:", response);
              // Hier können Sie dem Benutzer eine Erfolgsmeldung anzeigen
            },
            error: function (error) {
              console.log("Fehler:", error);
              // Hier können Sie dem Benutzer eine Fehlermeldung anzeigen
            },
          });
        });
      });
    </script>
    <script>
      function profil_Kunde() {
        $(document).ready(function () {
          $.ajax({
            url: "http://localhost:8000/api/kunde/profil",
            type: "get",
            headers: {
              Authorization: "Bearer " + sessionStorage.getItem("accessToken"),
            },
          })
            .done(function (response) {
              console.log(response);
              //console.log(response.rolleId);
              if (response.rolleId === 2) {
                //Kunde = 2, Unternehmen = 3
                var aktivitaetErstellenTabs = document.getElementsByClassName(
                  "aktivitaet_erstellen"
                );
                var meineErstelltenAktivitaetenTabs =
                  document.getElementsByClassName(
                    "meine_erstellten_aktivitaeten"
                  );

                Array.from(aktivitaetErstellenTabs).forEach(function (tab) {
                  tab.style.display = "none";
                });

                Array.from(meineErstelltenAktivitaetenTabs).forEach(function (
                  tab
                ) {
                  tab.style.display = "none";
                });
              } else if (response.rolleId === 3) {
                var zahlungsdetailsTabs =
                  document.getElementsByClassName("zahlungsdetails_");
                var meineBuchungenTabs =
                  document.getElementsByClassName("meine_buchungen");

                Array.from(meineBuchungenTabs).forEach(function (tab) {
                  tab.style.display = "none";
                });

                Array.from(zahlungsdetailsTabs).forEach(function (tab) {
                  tab.style.display = "none";
                });
              }
            })
            .fail(function (jqXHR, statusText, error) {
              //console.error('Fehler beim Abrufen der Benutzerdaten:', statusText, error);
              return false;
            });
        });
      }

      function profil_Unternehmen() {
        $(document).ready(function () {
          $.ajax({
            url: "http://localhost:8000/api/unternehmen/profil",
            type: "get",
            headers: {
              Authorization: "Bearer " + sessionStorage.getItem("accessToken"),
            },
          })
            .done(function (response) {
              console.log(response);
              //console.log(response.rolleId);
              if (response.rolleId === 2) {
                //Kunde = 2, Unternehmen = 3
                var aktivitaetErstellenTabs = document.getElementsByClassName(
                  "aktivitaet_erstellen"
                );
                var meineErstelltenAktivitaetenTabs =
                  document.getElementsByClassName(
                    "meine_erstellten_aktivitaeten"
                  );

                Array.from(aktivitaetErstellenTabs).forEach(function (tab) {
                  tab.style.display = "none";
                });

                Array.from(meineErstelltenAktivitaetenTabs).forEach(function (
                  tab
                ) {
                  tab.style.display = "none";
                });
              } else if (response.rolleId === 3) {
                var zahlungsdetailsTabs =
                  document.getElementsByClassName("zahlungsdetails_");
                var meineBuchungenTabs =
                  document.getElementsByClassName("meine_buchungen");

                Array.from(meineBuchungenTabs).forEach(function (tab) {
                  tab.style.display = "none";
                });

                Array.from(zahlungsdetailsTabs).forEach(function (tab) {
                  tab.style.display = "none";
                });
              }
            })
            .fail(function (jqXHR, statusText, error) {
              //console.error('Fehler beim Abrufen der Benutzerdaten:', statusText, error);
              return false;
            });
        });
      }

      function checkToken() {
        const accessToken = sessionStorage.getItem("accessToken");
        if (!accessToken) {
          var dropdown_m = document.getElementsByClassName("dropdown_menue");

          Array.from(dropdown_m).forEach(function (tab) {
            tab.style.display = "none";
          });
          document.getElementById("dropdown_logout").style.display = "none";
        } else {
          document.getElementById("dropdown_login").style.display = "none";
          profil_Kunde();
          profil_Unternehmen();

          const jwtPayload = JSON.parse(window.atob(accessToken.split(".")[1]));
          const datetime = new Date(jwtPayload.exp * 1000);
          console.log("expiry time (epoch):", jwtPayload.exp * 1000);
          console.log("expiry time (ISO):", datetime.toISOString());
          const isExpired = Date.now() >= jwtPayload.exp * 1000;
          console.log("token is expired:", isExpired);
          if (isExpired == true) {
            window.location = "/login";
          } else {
            document.getElementsByTagName("body")[0].style.display = "block";
          }
        }
      }

      function logoutUser() {
        sessionStorage.removeItem("accessToken");
      }
    </script>
  </body>
</html>
